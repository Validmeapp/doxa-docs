---
title: "Autentica√ß√£o"
description: "Aprenda como se autenticar com nossa API usando v√°rios m√©todos"
version: "v1"
locale: "pt"
order: 2
tags: ["autentica√ß√£o", "seguran√ßa"]
---

# Autentica√ß√£o

Nossa API suporta m√∫ltiplos m√©todos de autentica√ß√£o para proteger suas aplica√ß√µes e os dados dos usu√°rios.

## Chaves de API

O m√©todo principal de autentica√ß√£o utiliza chaves de API que voc√™ pode gerar no seu painel do desenvolvedor.

### Obtendo Chaves de API

1. Fa√ßa login no seu painel do desenvolvedor
2. Navegue at√© a se√ß√£o "Chaves de API"
3. Clique em "Gerar Nova Chave"
4. Copie e armazene sua chave com seguran√ßa

### Usando Chaves de API

Inclua sua chave de API no cabe√ßalho Authorization:

```bash
curl -H "Authorization: Bearer SUA_CHAVE_API" \
  https://api.example.com/v1/users
```

```javascript
const response = await fetch('https://api.example.com/v1/users', {
  headers: {
    'Authorization': 'Bearer SUA_CHAVE_API',
    'Content-Type': 'application/json'
  }
});
```

```python
import requests

headers = {
    'Authorization': 'Bearer SUA_CHAVE_API',
    'Content-Type': 'application/json'
}

response = requests.get('https://api.example.com/v1/users', headers=headers)
```

## OAuth 2.0

Para aplica√ß√µes que precisam agir em nome dos usu√°rios, suportamos OAuth 2.0 com PKCE.

### Fluxo de Autoriza√ß√£o

1. **Solicita√ß√£o de Autoriza√ß√£o**: Redirecione usu√°rios para nosso servidor de autoriza√ß√£o
2. **Consentimento do Usu√°rio**: Usu√°rios concedem permiss√µes √† sua aplica√ß√£o
3. **C√≥digo de Autoriza√ß√£o**: Receba um c√≥digo de autoriza√ß√£o
4. **Troca de Token**: Troque o c√≥digo por tokens de acesso

### Exemplo de Implementa√ß√£o

```javascript
// Passo 1: Redirecionar para o servidor de autoriza√ß√£o
const authUrl = `https://auth.example.com/oauth/authorize?` +
  `client_id=${clientId}&` +
  `redirect_uri=${redirectUri}&` +
  `response_type=code&` +
  `scope=read:users write:users&` +
  `code_challenge=${codeChallenge}&` +
  `code_challenge_method=S256`;

window.location.href = authUrl;
```

```javascript
// Passo 2: Trocar c√≥digo por token
const tokenResponse = await fetch('https://auth.example.com/oauth/token', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    grant_type: 'authorization_code',
    client_id: clientId,
    code: authorizationCode,
    redirect_uri: redirectUri,
    code_verifier: codeVerifier
  })
});

const tokens = await tokenResponse.json();
```

### Escopos Dispon√≠veis

| Escopo | Descri√ß√£o |
|--------|-----------|
| `read:users` | Ler informa√ß√µes de usu√°rios |
| `write:users` | Criar e modificar usu√°rios |
| `read:identity` | Ler dados de verifica√ß√£o de identidade |
| `write:identity` | Iniciar verifica√ß√µes de identidade |
| `read:webhooks` | Ler configura√ß√£o de webhooks |
| `write:webhooks` | Gerenciar webhooks |

## Tokens JWT

Para comunica√ß√£o servidor-a-servidor, suportamos tokens JWT com assinatura RS256.

### Estrutura do Token

```json
{
  "header": {
    "alg": "RS256",
    "typ": "JWT"
  },
  "payload": {
    "iss": "https://api.example.com",
    "sub": "user_id",
    "aud": "seu_client_id",
    "exp": 1234567890,
    "iat": 1234567890,
    "scope": "read:users"
  }
}
```

### Gerar Token JWT

```javascript
const jwt = require('jsonwebtoken');
const fs = require('fs');

// Carregar sua chave privada
const privateKey = fs.readFileSync('private-key.pem');

const payload = {
  iss: 'seu_client_id',
  sub: 'user_id',
  aud: 'https://api.example.com',
  exp: Math.floor(Date.now() / 1000) + (60 * 60), // 1 hora
  iat: Math.floor(Date.now() / 1000),
  scope: 'read:users write:users'
};

const token = jwt.sign(payload, privateKey, { algorithm: 'RS256' });
```

```python
import jwt
import time
from cryptography.hazmat.primitives import serialization

# Carregar sua chave privada
with open('private-key.pem', 'rb') as key_file:
    private_key = serialization.load_pem_private_key(
        key_file.read(),
        password=None
    )

payload = {
    'iss': 'seu_client_id',
    'sub': 'user_id',
    'aud': 'https://api.example.com',
    'exp': int(time.time()) + 3600,  # 1 hora
    'iat': int(time.time()),
    'scope': 'read:users write:users'
}

token = jwt.encode(payload, private_key, algorithm='RS256')
```

## Autentica√ß√£o de Webhooks

Os webhooks utilizam assinaturas HMAC-SHA256 para verificar a autenticidade.

### Verificar Assinatura de Webhook

```javascript
const crypto = require('crypto');

function verificarAssinaturaWebhook(payload, signature, secret) {
  const expectedSignature = crypto
    .createHmac('sha256', secret)
    .update(payload, 'utf8')
    .digest('hex');
  
  return `sha256=${expectedSignature}` === signature;
}

// Usar no seu endpoint de webhook
app.post('/webhooks/identity', (req, res) => {
  const signature = req.headers['x-webhook-signature'];
  const payload = req.body;
  
  if (!verificarAssinaturaWebhook(payload, signature, process.env.WEBHOOK_SECRET)) {
    return res.status(401).send('Assinatura inv√°lida');
  }
  
  // Processar o webhook
  const event = JSON.parse(payload);
  console.log('Evento recebido:', event.type);
  
  res.status(200).send('OK');
});
```

```python
import hmac
import hashlib

def verificar_assinatura_webhook(payload, signature, secret):
    expected_signature = hmac.new(
        secret.encode('utf-8'),
        payload.encode('utf-8'),
        hashlib.sha256
    ).hexdigest()
    
    return f"sha256={expected_signature}" == signature

# Usar no seu endpoint de webhook
from flask import Flask, request

app = Flask(__name__)

@app.route('/webhooks/identity', methods=['POST'])
def webhook_identity():
    signature = request.headers.get('X-Webhook-Signature')
    payload = request.get_data(as_text=True)
    
    if not verificar_assinatura_webhook(payload, signature, os.environ['WEBHOOK_SECRET']):
        return 'Assinatura inv√°lida', 401
    
    # Processar o webhook
    event = request.get_json()
    print(f'Evento recebido: {event["type"]}')
    
    return 'OK', 200
```

## Melhores Pr√°ticas de Seguran√ßa

### Gerenciamento de Chaves

- **Nunca exponha chaves de API** no c√≥digo do lado do cliente
- **Use vari√°veis de ambiente** para armazenar chaves sens√≠veis
- **Rotacione as chaves regularmente** para maior seguran√ßa
- **Use chaves diferentes** para desenvolvimento e produ√ß√£o
- **Revogue chaves comprometidas** imediatamente

### Implementa√ß√£o Segura

```javascript
// ‚úÖ Correto: Usar vari√°veis de ambiente
const apiKey = process.env.API_KEY;

// ‚ùå Incorreto: Hardcoded keys
const apiKey = 'sk_live_1234567890abcdef';
```

### Tratamento de Erros

Implemente tratamento de erros apropriado para evitar vazamento de informa√ß√µes:

```javascript
async function fazerSolicitacaoAPI(url, options) {
  try {
    const response = await fetch(url, options);
    
    if (!response.ok) {
      const error = await response.json();
      
      // Registrar erro para debugging
      console.error('Erro da API:', error);
      
      // Retornar erro gen√©rico ao usu√°rio
      throw new Error('Erro na solicita√ß√£o. Tente novamente.');
    }
    
    return await response.json();
  } catch (error) {
    // N√£o expor detalhes internos
    throw new Error('Erro de conex√£o. Verifique sua conex√£o com a internet.');
  }
}
```

### Limites de Taxa

Implemente l√≥gica de tentativas para lidar com limites de taxa:

```javascript
async function solicitacaoComTentativas(url, options, maxTentativas = 3) {
  for (let tentativa = 0; tentativa < maxTentativas; tentativa++) {
    try {
      const response = await fetch(url, options);
      
      if (response.status === 429) {
        const retryAfter = response.headers.get('Retry-After');
        const delay = retryAfter ? parseInt(retryAfter) * 1000 : Math.pow(2, tentativa) * 1000;
        
        console.log(`Limite de taxa atingido. Tentando novamente em ${delay}ms`);
        await new Promise(resolve => setTimeout(resolve, delay));
        continue;
      }
      
      return response;
    } catch (error) {
      if (tentativa === maxTentativas - 1) throw error;
      
      const delay = Math.pow(2, tentativa) * 1000;
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
}
```

## C√≥digos de Erro Comuns

| C√≥digo | Descri√ß√£o | Solu√ß√£o |
|--------|-----------|---------|
| `401` | N√£o autorizado | Verifique sua chave de API |
| `403` | Proibido | Verifique suas permiss√µes |
| `429` | Limite de taxa | Implemente l√≥gica de tentativas |
| `500` | Erro do servidor | Entre em contato com o suporte |

## Monitoramento e Auditoria

### Registrar Solicita√ß√µes

```javascript
const winston = require('winston');

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'api-requests.log' })
  ]
});

async function solicitacaoAPI(url, options) {
  const startTime = Date.now();
  
  try {
    const response = await fetch(url, options);
    
    logger.info({
      url,
      method: options.method || 'GET',
      status: response.status,
      duration: Date.now() - startTime,
      timestamp: new Date().toISOString()
    });
    
    return response;
  } catch (error) {
    logger.error({
      url,
      method: options.method || 'GET',
      error: error.message,
      duration: Date.now() - startTime,
      timestamp: new Date().toISOString()
    });
    
    throw error;
  }
}
```

## Suporte

Tem d√∫vidas sobre autentica√ß√£o? Estamos aqui para ajudar:

- **Documenta√ß√£o**: Consulte nosso guia completo
- **Suporte T√©cnico**: support@example.com
- **F√≥rum de Desenvolvedores**: community.example.com
- **Chat ao Vivo**: Dispon√≠vel no seu painel do desenvolvedor

Mantenha suas integra√ß√µes seguras! üîí