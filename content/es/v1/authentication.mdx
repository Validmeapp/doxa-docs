---
title: "Autenticaci√≥n"
description: "Aprende c√≥mo autenticarte con nuestra API usando varios m√©todos"
version: "v1"
locale: "es"
order: 2
tags: ["autenticaci√≥n", "seguridad"]
---

# Autenticaci√≥n

Nuestra API soporta m√∫ltiples m√©todos de autenticaci√≥n para asegurar tus aplicaciones y proteger los datos de los usuarios.

## Claves de API

El m√©todo principal de autenticaci√≥n utiliza claves de API que puedes generar en tu panel de desarrollador.

### Obtener Claves de API

1. Inicia sesi√≥n en tu panel de desarrollador
2. Navega a la secci√≥n "Claves de API"
3. Haz clic en "Generar Nueva Clave"
4. Copia y almacena tu clave de forma segura

### Usar Claves de API

Incluye tu clave de API en el header de Authorization:

```bash
curl -H "Authorization: Bearer TU_CLAVE_API" \
  https://api.example.com/v1/users
```

```javascript
const response = await fetch('https://api.example.com/v1/users', {
  headers: {
    'Authorization': 'Bearer TU_CLAVE_API',
    'Content-Type': 'application/json'
  }
});
```

```python
import requests

headers = {
    'Authorization': 'Bearer TU_CLAVE_API',
    'Content-Type': 'application/json'
}

response = requests.get('https://api.example.com/v1/users', headers=headers)
```

## OAuth 2.0

Para aplicaciones que necesitan actuar en nombre de los usuarios, soportamos OAuth 2.0 con PKCE.

### Flujo de Autorizaci√≥n

1. **Solicitud de Autorizaci√≥n**: Redirige a los usuarios a nuestro servidor de autorizaci√≥n
2. **Consentimiento del Usuario**: Los usuarios otorgan permisos a tu aplicaci√≥n
3. **C√≥digo de Autorizaci√≥n**: Recibe un c√≥digo de autorizaci√≥n
4. **Intercambio de Token**: Intercambia el c√≥digo por tokens de acceso

### Ejemplo de Implementaci√≥n

```javascript
// Paso 1: Redirigir al servidor de autorizaci√≥n
const authUrl = 'https://auth.example.com/oauth/authorize?' +
  'client_id=${clientId}&' +
  'redirect_uri=${redirectUri}&' +
  'response_type=code&' +
  'scope=read:users write:users&' +
  'code_challenge=${codeChallenge}&' +
  'code_challenge_method=S256';

window.location.href = authUrl;
```

```javascript
// Paso 2: Intercambiar c√≥digo por token
const tokenResponse = await fetch('https://auth.example.com/oauth/token', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    grant_type: 'authorization_code',
    client_id: clientId,
    code: authorizationCode,
    redirect_uri: redirectUri,
    code_verifier: codeVerifier
  })
});

const tokens = await tokenResponse.json();
```

### Scopes Disponibles

| Scope | Descripci√≥n |
|-------|-------------|
| `read:users` | Leer informaci√≥n de usuarios |
| `write:users` | Crear y modificar usuarios |
| `read:identity` | Leer datos de verificaci√≥n de identidad |
| `write:identity` | Iniciar verificaciones de identidad |
| `read:webhooks` | Leer configuraci√≥n de webhooks |
| `write:webhooks` | Gestionar webhooks |

## Tokens JWT

Para comunicaci√≥n servidor-a-servidor, soportamos tokens JWT con firma RS256.

### Estructura del Token

```json
{
  "header": {
    "alg": "RS256",
    "typ": "JWT"
  },
  "payload": {
    "iss": "https://api.example.com",
    "sub": "user_id",
    "aud": "tu_client_id",
    "exp": 1234567890,
    "iat": 1234567890,
    "scope": "read:users"
  }
}
```

### Generar Token JWT

```javascript
const jwt = require('jsonwebtoken');
const fs = require('fs');

// Cargar tu clave privada
const privateKey = fs.readFileSync('private-key.pem');

const payload = {
  iss: 'tu_client_id',
  sub: 'user_id',
  aud: 'https://api.example.com',
  exp: Math.floor(Date.now() / 1000) + (60 * 60), // 1 hora
  iat: Math.floor(Date.now() / 1000),
  scope: 'read:users write:users'
};

const token = jwt.sign(payload, privateKey, { algorithm: 'RS256' });
```

```python
import jwt
import time
from cryptography.hazmat.primitives import serialization

# Cargar tu clave privada
with open('private-key.pem', 'rb') as key_file:
    private_key = serialization.load_pem_private_key(
        key_file.read(),
        password=None
    )

payload = {
    'iss': 'tu_client_id',
    'sub': 'user_id',
    'aud': 'https://api.example.com',
    'exp': int(time.time()) + 3600,  # 1 hora
    'iat': int(time.time()),
    'scope': 'read:users write:users'
}

token = jwt.encode(payload, private_key, algorithm='RS256')
```

## Autenticaci√≥n de Webhooks

Los webhooks utilizan firmas HMAC-SHA256 para verificar la autenticidad.

### Verificar Firma de Webhook

```javascript
const crypto = require('crypto');

function verificarFirmaWebhook(payload, signature, secret) {
  const expectedSignature = crypto
    .createHmac('sha256', secret)
    .update(payload, 'utf8')
    .digest('hex');
  
  return `sha256=${expectedSignature}` === signature;
}

// Usar en tu endpoint de webhook
app.post('/webhooks/identity', (req, res) => {
  const signature = req.headers['x-webhook-signature'];
  const payload = req.body;
  
  if (!verificarFirmaWebhook(payload, signature, process.env.WEBHOOK_SECRET)) {
    return res.status(401).send('Firma inv√°lida');
  }
  
  // Procesar el webhook
  const event = JSON.parse(payload);
  console.log('Evento recibido:', event.type);
  
  res.status(200).send('OK');
});
```

```python
import hmac
import hashlib

def verificar_firma_webhook(payload, signature, secret):
    expected_signature = hmac.new(
        secret.encode('utf-8'),
        payload.encode('utf-8'),
        hashlib.sha256
    ).hexdigest()
    
    return f"sha256={expected_signature}" == signature

# Usar en tu endpoint de webhook
from flask import Flask, request

app = Flask(__name__)

@app.route('/webhooks/identity', methods=['POST'])
def webhook_identity():
    signature = request.headers.get('X-Webhook-Signature')
    payload = request.get_data(as_text=True)
    
    if not verificar_firma_webhook(payload, signature, os.environ['WEBHOOK_SECRET']):
        return 'Firma inv√°lida', 401
    
    # Procesar el webhook
    event = request.get_json()
    print(f'Evento recibido: {event["type"]}')
    
    return 'OK', 200
```

## Mejores Pr√°cticas de Seguridad

### Gesti√≥n de Claves

- **Nunca expongas claves de API** en c√≥digo del lado del cliente
- **Usa variables de entorno** para almacenar claves sensibles
- **Rota las claves regularmente** para mayor seguridad
- **Usa claves diferentes** para desarrollo y producci√≥n
- **Revoca claves comprometidas** inmediatamente

### Implementaci√≥n Segura

```javascript
// ‚úÖ Correcto: Usar variables de entorno
const apiKey = process.env.API_KEY;

// ‚ùå Incorrecto: Hardcodear claves
const apiKey = 'sk_live_1234567890abcdef';
```

### Manejo de Errores

Implementa manejo de errores apropiado para evitar filtraci√≥n de informaci√≥n:

```javascript
async function hacerSolicitudAPI(url, options) {
  try {
    const response = await fetch(url, options);
    
    if (!response.ok) {
      const error = await response.json();
      
      // Registrar error para debugging
      console.error('Error de API:', error);
      
      // Devolver error gen√©rico al usuario
      throw new Error('Error en la solicitud. Int√©ntalo de nuevo.');
    }
    
    return await response.json();
  } catch (error) {
    // No exponer detalles internos
    throw new Error('Error de conexi√≥n. Verifica tu conexi√≥n a internet.');
  }
}
```

### L√≠mites de Velocidad

Implementa l√≥gica de reintentos para manejar l√≠mites de velocidad:

```javascript
async function solicitudConReintentos(url, options, maxReintentos = 3) {
  for (let intento = 0; intento < maxReintentos; intento++) {
    try {
      const response = await fetch(url, options);
      
      if (response.status === 429) {
        const retryAfter = response.headers.get('Retry-After');
        const delay = retryAfter ? parseInt(retryAfter) * 1000 : Math.pow(2, intento) * 1000;
        
        console.log(`L√≠mite de velocidad alcanzado. Reintentando en ${delay}ms`);
        await new Promise(resolve => setTimeout(resolve, delay));
        continue;
      }
      
      return response;
    } catch (error) {
      if (intento === maxReintentos - 1) throw error;
      
      const delay = Math.pow(2, intento) * 1000;
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
}
```

## C√≥digos de Error Comunes

| C√≥digo | Descripci√≥n | Soluci√≥n |
|--------|-------------|----------|
| `401` | No autorizado | Verifica tu clave de API |
| `403` | Prohibido | Verifica tus permisos |
| `429` | L√≠mite de velocidad | Implementa l√≥gica de reintentos |
| `500` | Error del servidor | Contacta soporte |

## Monitoreo y Auditor√≠a

### Registrar Solicitudes

```javascript
const winston = require('winston');

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'api-requests.log' })
  ]
});

async function solicitudAPI(url, options) {
  const startTime = Date.now();
  
  try {
    const response = await fetch(url, options);
    
    logger.info({
      url,
      method: options.method || 'GET',
      status: response.status,
      duration: Date.now() - startTime,
      timestamp: new Date().toISOString()
    });
    
    return response;
  } catch (error) {
    logger.error({
      url,
      method: options.method || 'GET',
      error: error.message,
      duration: Date.now() - startTime,
      timestamp: new Date().toISOString()
    });
    
    throw error;
  }
}
```

## Soporte

¬øTienes preguntas sobre autenticaci√≥n? Estamos aqu√≠ para ayudar:

- **Documentaci√≥n**: Consulta nuestra gu√≠a completa
- **Soporte T√©cnico**: support@example.com
- **Foro de Desarrolladores**: community.example.com
- **Chat en Vivo**: Disponible en tu panel de desarrollador

¬°Mant√©n tus integraciones seguras! üîí